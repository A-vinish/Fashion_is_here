<!DOCTYPE html>
<html lang="en">
<head>
  <!--
    VisualMatch — Animated UI hooked to your Flask model
    - Keeps existing functionality (/api/search, /images/<file>)
    - Adds tasteful color, 3D tilt, parallax, reveal-on-scroll, shimmering buttons,
      aperture load animation, hover micro-interactions, and reduced repetition via templates.
    - No changes required in app.py
  -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>VisualMatch — AI Visual Search</title>

  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet" />

  <style>
    /* =========================
       THEME / TOKENS
       ========================= */
    :root{
      --bg: #f3f5f7;
      --surface: #ffffff;
      --text: #1f2937;
      --muted: #6b7280;

      --primary: #7c3aed;  /* purple */
      --primary-2: #6d28d9;
      --accent: #10b981;   /* green / success */
      --cyan: #06b6d4;
      --danger: #ef4444;

      --gradient-hero: radial-gradient(1200px 500px at 10% -20%, rgba(124,58,237,.25) 0%, rgba(124,58,237,.1) 40%, rgba(16,185,129,.06) 60%, transparent 70%),
                       radial-gradient(800px 300px at 90% -10%, rgba(99,102,241,.20) 0%, transparent 60%);
      --radius-lg: 22px;
      --radius-md: 16px;
      --radius-sm: 12px;

      --shadow-md: 0 10px 25px rgba(17,12,46,.08), 0 2px 6px rgba(17,12,46,.07);
      --shadow-lg: 0 30px 50px rgba(17,12,46,.12), 0 8px 18px rgba(17,12,46,.10);
      --ring: 0 0 0 8px rgba(124,58,237,.12);
      --transition: 220ms cubic-bezier(.22,1,.36,1);
    }

    /* =========================
       BASE
       ========================= */
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height:1.5;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      overflow-x:hidden;
    }
    a{color:inherit;text-decoration:none}
    img{display:block;max-width:100%}
    .container{max-width:1200px;margin-inline:auto;padding-inline:24px}
    .section{padding:48px 0}
    .title{font-size:32px;font-weight:700;letter-spacing:-.01em;margin:0 0 12px}
    .muted{color:var(--muted)}

    /* =========================
       SHARED UI ELEMENTS
       ========================= */
    .btn{
      display:inline-flex;align-items:center;gap:10px;
      font-weight:600; border:none; cursor:pointer;
      padding:12px 18px; border-radius:999px;
      background:linear-gradient(92deg, var(--primary), #8b5cf6, #22d3ee);
      background-size:200% 200%;
      color:#fff;
      box-shadow: var(--shadow-md);
      transition: transform var(--transition), box-shadow var(--transition);
      position:relative; overflow:hidden;
    }
    .btn:hover{transform:translateY(-2px); box-shadow: var(--shadow-lg)}
    .btn:active{transform:translateY(0)}
    .btn::after{ /* subtle shimmer */
      content:"";position:absolute;inset:0;pointer-events:none;
      background:linear-gradient(120deg, transparent 0%, rgba(255,255,255,.28) 14%, transparent 28%);
      transform:translateX(-120%);
      transition: transform 800ms ease;
    }
    .btn:hover::after{transform:translateX(180%)}
    .btn.secondary{
      background:#fff;color:var(--primary);
      border:2px solid rgba(124,58,237,.15)
    }
    .btn.secondary:hover{background:#faf5ff}

    .icon-btn{
      width:40px;height:40px;display:inline-grid;place-items:center;border-radius:50%;
      border:1px solid #e5e7eb;background:#fff;cursor:pointer;transition:transform var(--transition), box-shadow var(--transition), border-color var(--transition)
    }
    .icon-btn:hover{transform:translateY(-2px);box-shadow:var(--shadow-md);border-color:#ddd}

    /* Chips / Tags */
    .chip{
      display:inline-flex;align-items:center;gap:8px;
      padding:8px 14px;border-radius:999px;border:1px solid #e5e7eb;background:#fff;
      font-size:14px;color:#374151;cursor:pointer;transition:all var(--transition);
    }
    .chip:hover{transform:translateY(-1px); box-shadow:var(--shadow-md)}
    .chip.is-active{background:rgba(124,58,237,.09);border-color:rgba(124,58,237,.3);color:var(--primary)}

    /* ====== Header ====== */
    .site-header{
      position:sticky;top:0;z-index:60;background:rgba(255,255,255,.75);
      backdrop-filter:saturate(140%) blur(10px);
      border-bottom:1px solid rgba(2,6,23,.06)
    }
    .nav{height:70px;display:flex;align-items:center;justify-content:space-between;}
    .brand{display:flex;align-items:center;gap:10px;font-weight:800;font-size:22px;color:var(--primary)}
    .nav-links{display:flex;gap:28px;align-items:center}
    .nav-link{position:relative;font-weight:500;color:#334155}
    .nav-link:after{
      content:"";position:absolute;left:0;bottom:-8px;width:0;height:3px;border-radius:2px;background:linear-gradient(90deg,var(--primary),#22d3ee);
      transition:width var(--transition)
    }
    .nav-link:hover:after{width:100%}
    .nav-actions{display:flex;gap:14px;align-items:center}

    /* ====== HERO ====== */
    .hero{
      position:relative;border-radius:32px;margin-top:18px;background:#eef2ff;overflow:hidden;
      box-shadow:var(--shadow-lg); isolation:isolate;
    }
    .hero::before{
      content:"";position:absolute;inset:-2px;background:var(--gradient-hero);
      animation:bgShift 12s ease-in-out infinite alternate;transform:translateZ(0);z-index:-1;
    }
    @keyframes bgShift{to{transform: translate3d(-5%,3%,0) scale(1.04)}}
    .hero-inner{position:relative;padding:58px 28px}
    .hero h1{font-size:44px;line-height:1.15;margin:0 0 12px}
    .hero p{max-width:760px;color:#4b5563;margin:0 0 22px}
    .hero-actions{display:flex;gap:14px;flex-wrap:wrap}

    /* Floating decorative bubbles */
    .bubble{
      position:absolute;border-radius:50%;filter:blur(2px);opacity:.65;mix-blend-mode:multiply;
      animation:floatY 14s ease-in-out infinite;
    }
    .bubble.b1{width:120px;height:120px;left:5%;top:55%;background:radial-gradient(circle at 30% 30%, #a78bfa, #22d3ee)}
    .bubble.b2{width:160px;height:160px;left:65%;top:10%;background:radial-gradient(circle at 50% 40%, #34d399, #8b5cf6);animation-delay:-4s}
    .bubble.b3{width:90px;height:90px;left:80%;top:60%;background:radial-gradient(circle at 40% 40%, #f472b6, #60a5fa);animation-delay:-2s}
    @keyframes floatY{
      0%,100%{transform:translateY(0)}
      50%{transform:translateY(-18px)}
    }

    .notice-card{
      background:#fff;border-radius:var(--radius-lg);padding:26px;box-shadow:var(--shadow-lg);
      display:flex;flex-direction:column;gap:6px;max-width:780px;margin-top:28px;position:relative;overflow:hidden;
    }
    .notice-card::after{ /* subtle glossy sweep */
      content:"";position:absolute;inset:0;background:linear-gradient(120deg, transparent, rgba(255,255,255,.35), transparent);
      transform:translateX(-120%);transition:transform 1.2s ease;
    }
    .notice-card:hover::after{transform:translateX(160%)}

    /* ====== CARDS ====== */
    .grid{display:grid;gap:24px}
    .grid-3{grid-template-columns:repeat(3,minmax(0,1fr))}
    @media (max-width:1024px){.grid-3{grid-template-columns:repeat(2,minmax(0,1fr))}}
    @media (max-width:720px){.grid-3{grid-template-columns:1fr}}
    .card{
      background:var(--surface);border-radius:var(--radius-lg);box-shadow:var(--shadow-md);overflow:hidden;position:relative;
      transition: transform var(--transition), box-shadow var(--transition);
      transform-style:preserve-3d; /* 3D tilt base */
    }
    .card:hover{transform:translateY(-6px);box-shadow:var(--shadow-lg)}
    .card-media{position:relative;overflow:hidden;perspective:1000px}
    .card-media img{width:100%;height:240px;object-fit:cover;transform-origin:center; transition:transform .5s ease}
    /*Here is the line of tilted movement of Result*/
    .card:hover .card-media img{transform:scale(1.06)} 
    .card-body{padding:16px 18px 18px}
    .badge{
      position:absolute;left:16px;top:16px;background:linear-gradient(90deg,#7c3aed,#06b6d4);color:#fff;border-radius:999px;padding:6px 10px;font-size:12px;font-weight:700;
      box-shadow:0 6px 18px rgba(124,58,237,.35);
      animation:pulseGlow 2.2s ease-in-out infinite;
    }
    @keyframes pulseGlow{
      0%,100%{filter:drop-shadow(0 0 0 rgba(124,58,237,.0));transform:translateZ(20px)}
      50%{filter:drop-shadow(0 0 12px rgba(124,58,237,.45));transform:translateZ(26px)}
    }
    .fav{
      position:absolute;right:16px;top:16px;width:38px;height:38px;border-radius:50%;display:grid;place-items:center;background:#fff;border:1px solid #e5e7eb;cursor:pointer;
      transition:transform var(--transition), background var(--transition), color var(--transition); color:#334155
    }
    .fav:hover{transform:scale(1.06)}
    .fav[aria-pressed="true"]{background:rgba(239,68,68,.1);color:#ef4444;border-color:rgba(239,68,68,.2)}
    .tag-list{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    .tag{background:#f3f4f6;border:1px solid #e5e7eb;border-radius:999px;padding:6px 10px;font-size:12px;color:#374151}
    .product-card .card-media img{height:220px}
    .price{font-weight:800;font-size:20px;margin-top:10px}
    .btn-outline{
      background:#fff;color:#111827;border:2px solid #e5e7eb;padding:10px 16px;border-radius:999px;font-weight:600;cursor:pointer;transition:all var(--transition);
      position:relative;overflow:hidden;
    }
    .btn-outline:hover{transform:translateY(-2px); border-color:#d1d5db}
    .btn-outline::after{
      content:"";position:absolute;inset:0;background:linear-gradient(120deg, transparent, rgba(124,58,237,.16), transparent);
      transform:translateX(-120%);transition:transform .8s ease;
    }
    .btn-outline:hover::after{transform:translateX(160%)}

    /* ====== Search / Panel ====== */
    .panel{background:#f7f7fb;border:1px solid #eef; border-radius:28px;padding:26px}
    .searchbar{display:flex;gap:10px;align-items:center;background:#fff;padding:6px;border-radius:999px;border:1px solid #e5e7eb;box-shadow:var(--shadow-md)}
    .searchbar input{flex:1;border:none;padding:14px 16px;background:transparent;font-size:16px;outline:none}
    .searchbar button{padding:12px 14px;border-radius:999px;border:none;background:var(--primary);color:#fff;display:grid;place-items:center;cursor:pointer;transition:transform var(--transition)}
    .searchbar button:hover{transform:translateY(-2px)}
    .pill-row{display:flex;flex-wrap:wrap;gap:10px}
    .cat-grid{display:grid;grid-template-columns:repeat(6,minmax(0,1fr));gap:16px;margin-top:16px}
    @media (max-width:1100px){.cat-grid{grid-template-columns:repeat(3,minmax(0,1fr))}}
    @media (max-width:640px){.cat-grid{grid-template-columns:repeat(2,minmax(0,1fr))}}
    .cat{
      background:#fff;border:1px solid #e5e7eb;border-radius:22px; padding:22px; display:flex;flex-direction:column; align-items:center; gap:12px;
      transition:transform var(--transition), box-shadow var(--transition), border-color var(--transition);
    }
    .cat i{font-size:22px;color:var(--primary)}
    .cat:hover{transform:translateY(-4px);box-shadow:var(--shadow-md);border-color:#ddd}
    .center{display:flex;justify-content:center}

    /* ====== Footer ====== */
    footer{margin-top:32px;padding:36px 0;border-top:1px solid #e5e7eb;background:#fbfbff}
    .footer-grid{display:grid;grid-template-columns:2fr 1fr 1fr 1fr;gap:28px}
    @media (max-width:900px){.footer-grid{grid-template-columns:1fr 1fr}}
    @media (max-width:600px){.footer-grid{grid-template-columns:1fr}}

    /* ====== Reveal / Parallax ====== */
    .reveal{opacity:0;transform:translateY(16px) scale(.98);transition:all .9s cubic-bezier(.22,1,.36,1)}
    .reveal.in-view{opacity:1;transform:translateY(0) scale(1)}

    /* ====== Aperture intro (on load) ====== */
    #aperture{
      position:fixed;inset:0;background:#0b0b14;z-index:1000;display:grid;place-items:center;
      clip-path:circle(0% at 50% 50%); transition:clip-path 1100ms ease-in-out, opacity 400ms ease 900ms;
    }
    #aperture.released{clip-path:circle(140% at 50% 50%); opacity:0; pointer-events:none}
    .aperture-ring{
      width:180px;height:180px;border-radius:50%;
      background:conic-gradient(from 0deg,#7c3aed 0 120deg,#06b6d4 120deg 240deg,#10b981 240deg 360deg);
      animation:spin 2.4s linear infinite;
      filter:drop-shadow(0 0 24px rgba(124,58,237,.35));
    }
    @keyframes spin{to{transform:rotate(360deg)}}

    /* ====== Rotatable/tilt (3D) ====== */
    .tilt-area{perspective:1000px}
    .tilt-3d{transform-style:preserve-3d;will-change:transform}
    .tilt-3d .card-media img{transform:translateZ(24px)}
  </style>
</head>
<body>
  <!-- Aperture intro -->
  <div id="aperture" aria-hidden="true">
    <div class="aperture-ring"></div>
  </div>

  <!-- Header -->
  <header class="site-header">
    <div class="container nav">
      <a class="brand" href="#"><span class="fa-solid fa-sparkles"></span>VisualMatch</a>
      <nav class="nav-links" aria-label="Primary">
        <a class="nav-link" href="#home">Home</a>
        <a class="nav-link" href="#upload">Upload</a>
        <a class="nav-link" href="#search">Search</a>
        <a class="nav-link" href="#favorites">Favorites</a>
      </nav>
      <div class="nav-actions">
        <button class="icon-btn" title="Notifications"><i class="fa-regular fa-bell"></i></button>
        <div class="avatar icon-btn" title="Avinish Kumar" style="border:none;background:
        radial-gradient(120% 100% at 30% 20%,#0000 0 30px,#a78bfa 30px),linear-gradient(135deg,#111827,#111827 60%,#0ea5e9);color:#67e8f9">
          <i class="fa-brands fa-github"></i>
        </div>
      </div>
    </div>
  </header>

  <main id="home" class="container">
    <!-- Hero -->
    <section class="hero section reveal" aria-label="Intro">
      <span class="bubble b1"></span>
      <span class="bubble b2"></span>
      <span class="bubble b3"></span>

      <div class="hero-inner">
        <h1>Find the perfect match for your <span style="color:var(--primary)">inspiration</span></h1>
        <p>Upload an image or describe what you're looking for, and our AI will find similar products and generate creative variations.</p>

        <div class="hero-actions">
          <button class="btn" id="btnUpload"><i class="fa-solid fa-cloud-arrow-up"></i> Upload Image</button>
          <button class="btn secondary" id="btnSearch"><i class="fa-solid fa-magnifying-glass"></i> Search</button>
          <!-- Hidden file input (real worker) -->
          <input type="file" id="fileInput" accept="image/*" hidden>
        </div>

        <div class="notice-card">
          <h3 class="title" style="font-size:18px;margin:0">Similar Items Found</h3>
          <p id="foundMsg" class="muted" style="margin:0">Here are some similar products</p>
        </div>
      </div>
    </section>

    <!-- Recent Uploads (static demo; kept functional identical, but generated via template to remove repetition) -->
    <section class="section reveal" aria-labelledby="recent-heading">
      <div class="section-head" style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px">
        <h2 id="recent-heading" class="title" style="margin:0">Recent Uploads</h2>
        <a href="#" class="muted">View all <i class="fa-solid fa-arrow-right-long"></i></a>
      </div>

      <div class="grid grid-3" id="recentGrid"></div>
    </section>

    <!-- AI Generated Variations (visual strip) -->
    <section class="section reveal" aria-labelledby="ai-heading">
      <div class="section-head" style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px">
        <h2 id="ai-heading" class="title" style="margin:0">AI-Generated Variations</h2>
        <a href="#" class="muted">Explore more <i class="fa-solid fa-arrow-right-long"></i></a>
      </div>

      <div class="gallery" role="list" style="display:grid;grid-auto-flow:column;grid-auto-columns:minmax(220px,1fr);gap:18px;overflow:auto;padding-bottom:6px;scroll-snap-type:x mandatory">
        <figure class="gallery-item" role="listitem" style="scroll-snap-align:start;border-radius:var(--radius-lg);overflow:hidden;position:relative;box-shadow:var(--shadow-md)">
          <img src="https://images.unsplash.com/photo-1555041469-a586c61ea9bc?q=80&w=1200&auto=format&fit=crop" alt="Scandinavian interior" style="height:260px;width:100%;object-fit:cover">
          <figcaption class="caption" style="position:absolute;left:0;right:0;bottom:0;background:linear-gradient(to top,rgba(0,0,0,.55),rgba(0,0,0,0));color:#fff;padding:14px;font-size:13px">Scandinavian interior</figcaption>
        </figure>
        <figure class="gallery-item" role="listitem" style="scroll-snap-align:start;border-radius:var(--radius-lg);overflow:hidden;position:relative;box-shadow:var(--shadow-md)">
          <img src="https://images.unsplash.com/photo-1519710164239-da123dc03ef4?q=80&w=1200&auto=format&fit=crop" alt="Minimalist living room" style="height:260px;width:100%;object-fit:cover">
          <figcaption class="caption" style="position:absolute;left:0;right:0;bottom:0;background:linear-gradient(to top,rgba(0,0,0,.55),rgba(0,0,0,0));color:#fff;padding:14px;font-size:13px">Minimalist living room</figcaption>
        </figure>
        <figure class="gallery-item" role="listitem" style="scroll-snap-align:start;border-radius:var(--radius-lg);overflow:hidden;position:relative;box-shadow:var(--shadow-md)">
          <img src="https://images.unsplash.com/photo-1598300183513-9d6d14f10fcd?q=80&w=1200&auto=format&fit=crop" alt="Floating shelves" style="height:260px;width:100%;object-fit:cover">
          <figcaption class="caption" style="position:absolute;left:0;right:0;bottom:0;background:linear-gradient(to top,rgba(0,0,0,.55),rgba(0,0,0,0));color:#fff;padding:14px;font-size:13px">Floating shelves</figcaption>
        </figure>
        <figure class="gallery-item" role="listitem" style="scroll-snap-align:start;border-radius:var(--radius-lg);overflow:hidden;position:relative;box-shadow:var(--shadow-md)">
          <img src="https://images.unsplash.com/photo-1540575467063-178a50c2df87?q=80&w=1200&auto=format&fit=crop" alt="Modern workspace" style="height:260px;width:100%;object-fit:cover">
          <figcaption class="caption" style="position:absolute;left:0;right:0;bottom:0;background:linear-gradient(to top,rgba(0,0,0,.55),rgba(0,0,0,0));color:#fff;padding:14px;font-size:13px">Modern workspace</figcaption>
        </figure>
        <figure class="gallery-item" role="listitem" style="scroll-snap-align:start;border-radius:var(--radius-lg);overflow:hidden;position:relative;box-shadow:var(--shadow-md)">
          <img src="https://images.unsplash.com/photo-1494526585095-c41746248156?q=80&w=1200&auto=format&fit=crop" alt="Architecture" style="height:260px;width:100%;object-fit:cover">
          <figcaption class="caption" style="position:absolute;left:0;right:0;bottom:0;background:linear-gradient(to top,rgba(0,0,0,.55),rgba(0,0,0,0));color:#fff;padding:14px;font-size:13px">Architecture</figcaption>
        </figure>
      </div>
    </section>

    <!-- Search by Description (kept visual & behavior) -->
    <section id="search" class="section reveal" aria-labelledby="search-heading">
      <div class="panel">
        <h2 id="search-heading" class="title">Search by Description</h2>
        <div class="searchbar" role="search">
          <input id="searchInput" type="text" placeholder="Describe what you're looking for…" aria-label="Search description">
          <button id="searchBtn" title="Search"><i class="fa-solid fa-magnifying-glass"></i></button>
        </div>

        <div style="margin-top:18px">
          <h3 style="margin:0 0 10px;font-size:18px">Popular searches</h3>
          <div class="pill-row" id="popularRow"></div>
        </div>

        <div style="margin-top:16px">
          <h3 style="margin:0 0 10px;font-size:18px">Categories</h3>
          <div class="cat-grid" id="catGrid"></div>
        </div>
      </div>
    </section>

    <!-- Product Matches (dynamic results from your model) -->
    <section class="section reveal" aria-labelledby="matches-heading">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px">
        <h2 id="matches-heading" class="title" style="margin:0">Product Matches</h2>
        <div class="muted">Sort by: <strong>Relevance</strong> <i class="fa-solid fa-chevron-down"></i></div>
      </div>

      <div class="grid grid-3 tilt-area" id="productGrid">
        <!-- Filled dynamically -->
      </div>

      <div class="center" style="margin-top:22px">
        <button id="loadMore" class="btn secondary"><span>Load more results</span> <i class="fa-solid fa-chevron-down"></i></button>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer role="contentinfo">
    <div class="container footer-grid">
      <div>
        <div class="brand" style="font-size:20px;margin-bottom:8px"><span class="fa-solid fa-sparkles"></span>VisualMatch</div>
        <p class="muted">Find the perfect matches for your design inspiration with our AI-powered visual search.</p>
      </div>
      <div>
        <h4 class="title" style="font-size:18px;margin-bottom:12px">Features</h4>
        <nav class="muted" aria-label="Features">
          <div>Image Upload</div>
          <div>AI Generation</div>
          <div>Product Matching</div>
          <div>Collections</div>
        </nav>
      </div>
      <div>
        <h4 class="title" style="font-size:18px;margin-bottom:12px">Support</h4>
        <nav class="muted" aria-label="Support">
          <div>Help Center</div>
          <div>Contact Us</div>
          <div>FAQs</div>
          <div>Privacy Policy</div>
        </nav>
      </div>
      <div>
        <h4 class="title" style="font-size:18px;margin-bottom:12px">Stay Connected</h4>
        <div style="display:flex;gap:14px">
          <a class="icon-btn" href="#" aria-label="Facebook"><i class="fa-brands fa-facebook-f"></i></a>
          <a class="icon-btn" href="#" aria-label="Twitter"><i class="fa-brands fa-x-twitter"></i></a>
          <a class="icon-btn" href="#" aria-label="Instagram"><i class="fa-brands fa-instagram"></i></a>
          <a class="icon-btn" href="#" aria-label="Pinterest"><i class="fa-brands fa-pinterest"></i></a>
        </div>
      </div>
    </div>
  </footer>

  <!-- Templates (remove repetition) -->
  <template id="recentCardTpl">
    <article class="card tilt-3d" tabindex="0" aria-label="Recent upload item">
      <div class="card-media">
        <span class="badge"></span>
        <button class="fav" aria-pressed="false" aria-label="Save to favorites"><i class="fa-regular fa-heart"></i></button>
        <img alt="">
      </div>
      <div class="card-body">
        <h3 style="margin:0 0 6px"></h3>
        <p class="muted" style="margin:0 0 10px"></p>
        <div class="tag-list"></div>
      </div>
    </article>
  </template>

  <template id="productCardTpl">
    <article class="card product-card tilt-3d" tabindex="0">
      <div class="card-media">
        <span class="badge"></span>
        <div class="fav" aria-pressed="false" aria-label="Save"><i class="fa-regular fa-heart"></i></div>
        <img alt="">
      </div>
      <div class="card-body">
        <h3 style="margin:0 0 6px"></h3>
        <p class="muted" style="margin:0 0 6px"></p>
        <div class="price"></div>
        <div style="margin-top:10px;display:flex;justify-content:flex-end">
          <button class="btn-outline viewBtn">View Details</button>
        </div>
      </div>
    </article>
  </template>

  <!-- JS (functionality preserved; animations/3D added) -->
  <script>
    /* ========= CONFIG ========= */
    const API_BASE = 'http://localhost:5000';
    const SEARCH_URL = `${API_BASE}/api/search`;       // expects FormData with 'image'
    const IMAGE_URL = (name) => `${API_BASE}/images/${encodeURIComponent(name)}`;

    /* ========= INTRO APERTURE ========= */
    window.addEventListener('load', () => {
      requestAnimationFrame(()=>document.getElementById('aperture').classList.add('released'));
    });

    /* ========= FAVORITES TOGGLE ========= */
    const delegateFav = (root=document) => {
      root.querySelectorAll('.fav').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const state = btn.getAttribute('aria-pressed') === 'true';
          btn.setAttribute('aria-pressed', String(!state));
          const ico = btn.querySelector('i');
          ico.classList.toggle('fa-regular', state);
          ico.classList.toggle('fa-solid', !state);
        });
      });
    };

    /* ========= 3D TILT ========= */
    function attachTilt(el){
      const media = el.querySelector('.card-media');
      let rect;
      const move = (x,y)=>{
        rect = rect || media.getBoundingClientRect();
        const dx = ((x - rect.left) / rect.width - 0.5) * 14;
        const dy = ((y - rect.top) / rect.height - 0.5) * -14;
        el.style.transform = `rotateY(${dx}deg) rotateX(${dy}deg) translateY(-6px)`;
      };
      el.addEventListener('mousemove', (e)=>move(e.clientX,e.clientY));
      el.addEventListener('mouseleave', ()=>{ el.style.transform = ''; rect = null; });
      el.addEventListener('touchmove', (e)=>{ const t=e.touches[0]; move(t.clientX,t.clientY); }, {passive:true});
      el.addEventListener('touchend', ()=>{ el.style.transform = ''; rect = null; });
    }

    /* ========= SCROLL REVEAL ========= */
    const io = new IntersectionObserver((entries)=>{
      entries.forEach(entry=>{
        if(entry.isIntersecting){
          entry.target.classList.add('in-view');
          io.unobserve(entry.target);
        }
      })
    }, {threshold:.18});
    document.querySelectorAll('.reveal').forEach(el=>io.observe(el));

    /* ========= POPULAR & CATEGORIES (no repetition) ========= */
    const popular = [
      'Mid-century modern sofa','Minimalist desk lamp','Scandinavian dining chair',
      'Industrial bookshelf','Ceramic vase set'
    ];
    const cats = [
      ['furniture','fa-couch'],
      ['lighting','fa-lightbulb'],
      ['bedroom','fa-bed'],
      ['kitchen','fa-kitchen-set'],
      ['tech','fa-display'],
      ['more','fa-ellipsis']
    ];
    const pillRow = document.getElementById('popularRow');
    popular.forEach(p=>{
      const b=document.createElement('button');
      b.className='chip';
      b.textContent=p;
      b.addEventListener('click', ()=>{
        document.getElementById('searchInput').value = p;
        pillRow.querySelectorAll('.chip').forEach(c=>c.classList.remove('is-active'));
        b.classList.add('is-active');
      });
      pillRow.appendChild(b);
    });
    const catGrid = document.getElementById('catGrid');
    cats.forEach(([key,icon])=>{
      const c=document.createElement('button');
      c.className='cat chip';
      c.setAttribute('data-category',key);
      c.innerHTML=`<i class="fa-regular ${icon}"></i> ${key.charAt(0).toUpperCase()+key.slice(1)}`;
      c.addEventListener('click', ()=>c.classList.toggle('is-active'));
      catGrid.appendChild(c);
    });

    /* ========= RECENT UPLOADS (template-driven) ========= */
    const recentData = [
      {
        title:'Modern Accent Chair',
        subtitle:'Uploaded 2 days ago',
        tags:['Furniture','Home Decor'],
        badge:'6 matches',
        img:'https://images.unsplash.com/photo-1616594039964-ae9021a400a0?q=80&w=1200&auto=format&fit=crop'
      },
      {
        title:'Minimalist Workspace',
        subtitle:'Uploaded 3 days ago',
        tags:['Office','Tech'],
        badge:'12 matches',
        img:'https://images.unsplash.com/photo-1498050108023-c5249f4df085?q=80&w=1200&auto=format&fit=crop'
      },
      {
        title:'Street Sneakers',
        subtitle:'Uploaded 1 week ago',
        tags:['Fashion','Footwear'],
        badge:'8 matches',
        img:'https://images.unsplash.com/photo-1491147334573-44cbb4602074?q=80&w=1200&auto=format&fit=crop'
      }
    ];
    const recentGrid = document.getElementById('recentGrid');
    const recentTpl = document.getElementById('recentCardTpl').content;
    recentData.forEach(d=>{
      const node = recentTpl.cloneNode(true);
      node.querySelector('.badge').textContent = d.badge;
      node.querySelector('img').src = d.img;
      node.querySelector('img').alt = d.title;
      node.querySelector('h3').textContent = d.title;
      node.querySelector('.muted').textContent = d.subtitle;
      const tags = node.querySelector('.tag-list');
      d.tags.forEach(t=>{ const s=document.createElement('span'); s.className='tag'; s.textContent=t; tags.appendChild(s); });
      const card = node.querySelector('.card');
      recentGrid.appendChild(node);
      attachTilt(recentGrid.lastElementChild); // add 3D tilt
    });
    delegateFav(recentGrid);

    /* ========= UPLOAD + SEARCH (HOOKED TO YOUR MODEL) ========= */
    const fileInput = document.getElementById('fileInput');
    const btnUpload = document.getElementById('btnUpload');
    const btnSearch = document.getElementById('btnSearch');
    const productGrid = document.getElementById('productGrid');
    const productTpl = document.getElementById('productCardTpl').content;
    const foundMsg = document.getElementById('foundMsg');
    const loadMoreBtn = document.getElementById('loadMore');

    let lastResults = []; // holds {filename, score}
    let visibleCount = 0;
    const PAGE = 6; // first render count; rest via "Load more"

    btnUpload.addEventListener('click', ()=> fileInput.click());
    btnSearch.addEventListener('click', ()=>{
      document.getElementById('matches-heading').scrollIntoView({behavior:'smooth'});
    });

    fileInput.addEventListener('change', async ()=>{
      if(!fileInput.files.length) return;
      productGrid.innerHTML = '';
      visibleCount = 0;
      foundMsg.textContent = 'Searching…';
      try{
        const fd = new FormData();
        fd.append('image', fileInput.files[0]);
        const res = await fetch(SEARCH_URL, { method: 'POST', body: fd });
        if(!res.ok){
          const e = await res.json().catch(()=>({error:'Server error'}));
          foundMsg.textContent = 'Error: ' + (e.error || 'Server error');
          return;
        }
        const data = await res.json();
        // Convert to {filename, score}
        const filenames = Array.isArray(data.filenames) ? data.filenames : [];
        const distances = Array.isArray(data.distances) ? data.distances[0] || [] : [];
        lastResults = filenames.map((f,i)=>({ filename:f, score: typeof distances[i]==='number' ? distances[i] : null }));
        if(lastResults.length){
          foundMsg.textContent = `Found ${lastResults.length} similar items`;
          renderMore(); // initial batch
          document.getElementById('matches-heading').scrollIntoView({behavior:'smooth'});
        }else{
          foundMsg.textContent = 'No similar items found.';
          productGrid.innerHTML = '';
        }
      }catch(err){
        console.error(err);
        foundMsg.textContent = 'Could not connect to backend.';
      }
    });

    function scoreToBadge(score){
      if(typeof score!=='number' || isNaN(score)) return 'Match';
      // Cosine/IP score in [0..1]; show as percentage
      const pct = Math.round(Math.max(0,Math.min(1,score))*100);
      return `${pct}% match`;
    }

    function renderCard(item){
      const node = productTpl.cloneNode(true);
      node.querySelector('.badge').textContent = scoreToBadge(item.score);
      node.querySelector('img').src = IMAGE_URL(item.filename);
      node.querySelector('img').alt = item.filename;
      node.querySelector('h3').textContent = prettifyName(item.filename);
      node.querySelector('.muted').textContent = 'Model Suggestion';
      node.querySelector('.price').textContent = randomPrice();
      productGrid.appendChild(node);
      const card = productGrid.lastElementChild;
      attachTilt(card); // 3D rotation
      delegateFav(card);
    }

    function renderMore(){
      const next = lastResults.slice(visibleCount, visibleCount + PAGE);
      next.forEach(renderCard);
      visibleCount += next.length;
      if(visibleCount >= lastResults.length){
        loadMoreBtn.disabled = true;
        loadMoreBtn.innerHTML = '<span>No more results</span>';
      }else{
        loadMoreBtn.disabled = false;
        loadMoreBtn.innerHTML = '<span>Load more results</span> <i class="fa-solid fa-chevron-down"></i>';
      }
    }

    loadMoreBtn.addEventListener('click', renderMore);

    function prettifyName(name){
      return name.replace(/\.[a-z0-9]+$/i,'')
                 .replace(/[_-]+/g,' ')
                 .replace(/\b\w/g, m=>m.toUpperCase());
    }
    function randomPrice(){
      // playful placeholder prices to match the visual; real price not in model
      const ranges = [[49,99],[129,299],[59,199]];
      const [min,max] = ranges[Math.floor(Math.random()*ranges.length)];
      const value = (Math.random()*(max-min)+min);
      return `$${value.toFixed(2)}`;
    }

    /* ========= SEARCH INPUT UX ========= */
    document.getElementById('searchBtn').addEventListener('click', ()=>{
      document.getElementById('matches-heading').scrollIntoView({behavior:'smooth'});
    });

    // Keyboard access: Enter toggles fav inside cards
    document.addEventListener('keydown', (e)=>{
      if(e.key === 'Enter' && document.activeElement?.classList.contains('card')){
        const fav = document.activeElement.querySelector('.fav');
        fav?.click();
      }
    });
  </script>
</body>
</html>
